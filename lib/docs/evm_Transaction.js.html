<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: evm/Transaction.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: evm/Transaction.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
/**
 * @file Transaction.js
 * @author Mosaic Networks &lt;https://github.com/mosaicnetworks>
 * @date 2018
 */
Object.defineProperty(exports, "__esModule", { value: true });
const JSONBig = require("json-bigint");
class Transaction {
    /**
     * Transaction object to be sent or called.
     *
     * @param {TX} _tx - The transaction options eg. gas, gas price, value...
     * @param {boolean} constant - If the transaction is constant
     * @param {Function} unpackfn - If constant unpack function
     * @param {Controller} controller - The controller class
     */
    constructor(_tx, constant, unpackfn, controller) {
        this._tx = _tx;
        this.constant = constant;
        this.unpackfn = unpackfn;
        this.controller = controller;
        this.receipt = undefined;
        if (!constant)
            this.unpackfn = undefined;
    }
    /**
     * Send transaction.
     *
     * This function will mutate the state of the EVM.
     *
     * @param {Object} options - The options to pass to the transaction
     */
    send(options) {
        if (!this.constant) {
            if (options) {
                this._tx.to = options.to || this._tx.to;
                this._tx.from = options.from || this._tx.from;
                this._tx.gas = options.gas || this._tx.gas;
                this._tx.value = options.value || this._tx.value;
                if (options.gasPrice !== undefined &amp;&amp; options.gasPrice >= 0) {
                    this._tx.gasPrice = options.gasPrice;
                }
            }
            if (this._tx.gas != null &amp;&amp; this._tx.gasPrice != null) {
                return this.controller.api.sendTx(JSONBig.stringify(this._tx))
                    .then((res) => {
                    let response = JSONBig.parse(res);
                    return response.txHash;
                })
                    .then((txHash) => {
                    return new Promise((resolve) => setTimeout(resolve, 2000))
                        .then(() => {
                        return this.controller.api.getReceipt(txHash);
                    });
                })
                    .then((resp) => {
                    this.receipt = JSONBig.parse(resp);
                    return this.receipt;
                });
            }
            else {
                throw new Error('gas &amp; gas price not set');
            }
        }
        else {
            throw new Error('Transaction does not mutate state. Use `call()` instead');
        }
    }
    /**
     * Call transaction.
     *
     * This function will not mutate the state of the EVM.
     *
     * @param {Object} options - The options to pass to the transaction
     */
    call(options) {
        if (this.constant) {
            if (options) {
                this._tx.to = options.to || this._tx.to;
                this._tx.from = options.from || this._tx.from;
                this._tx.gas = options.gas || this._tx.gas;
                this._tx.value = options.value || this._tx.value;
                if (options.gasPrice !== undefined &amp;&amp; options.gasPrice >= 0) {
                    this._tx.gasPrice = options.gasPrice;
                }
            }
            if (this._tx.gas != null &amp;&amp; this._tx.gasPrice != null) {
                return this.controller.api.call(JSONBig.stringify(this._tx))
                    .then((response) => {
                    return JSONBig.parse(response);
                })
                    .then((obj) => {
                    return this.unpackfn(Buffer.from(obj.data).toString());
                });
            }
            else {
                throw new Error('gas &amp; gas price not set');
            }
        }
        else {
            throw new Error('Transaction mutates state. Use `send()` instead');
        }
    }
    /**
     * Return transaction as string.
     *
     * @returns {string} Transaction as string
     */
    toString() {
        return JSONBig.stringify(this._tx);
    }
    /**
     * Sets the from of the transaction.
     *
     * @param {string} from - The from address
     * @returns {Transaction} The transaction
     */
    from(from) {
        this._tx.from = from;
        return this;
    }
    /**
     * Sets the to of the transaction.
     *
     * @param {string} to - The to address
     * @returns {Transaction} The transaction
     */
    to(to) {
        this._tx.to = to;
        return this;
    }
    /**
     * Sets the value of the transaction.
     *
     * @param {number} value - The value of tx
     * @returns {Transaction} The transaction
     */
    value(value) {
        this._tx.value = value;
        return this;
    }
    /**
     * Sets the gas of the transaction.
     *
     * @param {number} gas - The gas of tx
     * @returns {Transaction} The transaction
     */
    gas(gas) {
        this._tx.gas = gas;
        return this;
    }
    /**
     * Sets the gas price of the transaction.
     *
     * @param {number} gasPrice - The gas price of tx
     * @returns {Transaction} The transaction
     */
    gasPrice(gasPrice) {
        this._tx.gasPrice = gasPrice;
        return this;
    }
    /**
     * Sets the data of the transaction.
     *
     * @param {string} data - The data of tx
     * @returns {Transaction} The transaction
     */
    data(data) {
        this._tx.data = data;
        return this;
    }
}
exports.default = Transaction;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Controller.html">Controller</a></li><li><a href="SolidityContract.html">SolidityContract</a></li><li><a href="SolidityFunction.html">SolidityFunction</a></li><li><a href="Transaction.html">Transaction</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Oct 05 2018 17:13:38 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
